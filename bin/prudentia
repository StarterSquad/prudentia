#!/usr/bin/env python

import sys
import logging
import os
from os import path

if __name__ == "__main__":
    os.environ['PYTHONUNBUFFERED'] = '1'
    os.environ['PRUDENTIA_USER_DIR'] = PRUDENTIA_USER_DIR = path.join(path.expanduser('~'), 'prudentia')

    if not os.path.exists(PRUDENTIA_USER_DIR):
        os.makedirs(PRUDENTIA_USER_DIR)

    logging.basicConfig(
        filename=path.join(PRUDENTIA_USER_DIR, 'cli.log'),
        format='%(asctime)s.%(msecs).03d [%(name)s] %(levelname)s: %(message)s',
        datefmt='%d-%m-%Y %H:%M:%S',
        level=logging.WARNING
    )

    from prudentia.cli import CLI

    cli = CLI()

    exit_error = 0
    if len(sys.argv) > 1:
        one_cmd_provisioned = cli.do_use(sys.argv[1], *sys.argv[2:])
        exit_error = 0 if one_cmd_provisioned else 1
    else:
        cli.cmdloop()

    sys.exit(exit_error)
