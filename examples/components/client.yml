---
  - include: "{{prudentia_dir}}/tasks/nodejs.yml"
    tags: client

  - include: "{{prudentia_dir}}/tasks/ruby.yml"
    tags: client

  - name: Client | Compile
    shell: chdir={{install_dir_client}} /bin/bash -lc './clean_build.sh'
    tags:
      - client
      - update

  - include: "{{prudentia_dir}}/tasks/nginx.yml"
    tags: client

  - name: Client | Creating Nginx Log Dir
    command: mkdir -p /etc/nginx/logs
    sudo: yes
    tags: client

  - name: Client | Removing Nginx default site configuration
    command: rm -f /etc/nginx/sites-enabled/default
    sudo: yes
    tags: client

  - name: Client | Copy Nginx configuration
    template: src={{root_dir}}/components/templates/client/nginx.conf.j2 dest=/etc/nginx/sites-available/zorgdomein.com backup=yes
    sudo: yes
    tags:
      - client
      - update

  - name: Client | Enable website
    command: ln -fs /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/example.com
    sudo: yes
    tags:
      - client
      - update

  - name: Client | Restart Nginx
    command: /etc/init.d/nginx restart
    sudo: yes
    tags:
      - client
      - update
      - maintenance

  - name: Client | Health check
    shell: /usr/bin/curl -sSf --max-time 300 {{url_health_check}} > /dev/null
    tags:
      - api
      - update
