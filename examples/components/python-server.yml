---
  - include: {{prudentia_dir}}/tasks/python.yml

  - name: Example Server | Create log dir
    file: dest={{log_file_path}} owner={{ansible_user_id}} group={{ansible_user_id}} mode=755 state=directory
    tags: server

  - name: Example Server | Install python dependencies
    pip: requirements={{install_dir_server}}/requirements.txt state=present
    sudo: yes
    tags:
      - server
      - update

  - name: Example Server | Install gunicorn
    pip: name=gunicorn state=present
    sudo: yes
    tags: server

  - name: Example Server | Copy upstart script
    template: src={{root_dir}}/components/templates/python-upstart.conf.j2 dest=/etc/init/example-api.conf backup=yes
    register: server_upstart
    sudo: yes
    tags:
      - server
      - update

  - name: Example Server | Restart
    service: name=example-api state=restarted
    when: checkout.changed or server_upstart.changed
    sudo: yes
    tags:
      - server
      - update
